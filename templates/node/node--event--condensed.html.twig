{% set delta = 0 %}

{% if elements['#delta'] is not empty %}
  {% set delta = elements['#delta'] %}
{% endif %}

{# Use event_dates array to print any event dates - look inside array for formatted options #}
{% if event_dates|length > 1 %}
  {% set multi_day_text %}
    {% include "@atoms/typography/text/yds-text.twig" with {
      text__base_class: 'multi-day-event',
      text__content: '(multi-day event)',
    } %}
  {% endset %}
{% endif %}

{% set event_has_passed = content.field_event_date[delta].end_time['#markup']|date("U") < "now"|date("U") %}

{% set heading = content.field_teaser_title.0 ? content.field_teaser_title : label %}
{% set reference_card__image = 'false' %}
{% set url = content.field_external_source[0]['#url']|render ? content.field_external_source[0]['#url']|render : url %}

{# Used to test if we're ouputting for the same day or multiple days #}
{% set start_date = content.field_event_date[delta].start_time['#markup']|date('Y-m-d') %}
{% set end_date = content.field_event_date[delta].end_time['#markup']|date('Y-m-d') %}

{% set same_day = start_date == end_date %}

{# Check if this is an all-day event (starts at 00:00 and ends at 23:59) #}
{% set start_time = content.field_event_date[delta].start_time['#markup']|date('H:i') %}
{% set end_time = content.field_event_date[delta].end_time['#markup']|date('H:i') %}
{% set is_all_day = (start_time == '00:00' and end_time == '23:59') %}

{# Determine the date format based on whether the event starts and ends on the same day #}
{% set date_time__format = 'date_time_multiple_days' %}
{% if same_day %}
  {% set date_time__format = 'same_day_diff_time' %}
{% endif %}

{% set date__formatted %}
  {% include "@atoms/date-time/yds-date-time.twig" with {
    date_time__start: content.field_event_date[delta].start_time['#markup'],
    date_time__end: content.field_event_date[delta].end_time['#markup'],
    date_time__format: date_time__format,
    date_time__all_day: is_all_day,
  } %} {{multi_day_text}}
{% endset %}

{% include "@molecules/cards/reference-card/yds-reference-card.twig" with {
  event_has_passed: event_has_passed,
  reference_card__heading: heading,
  reference_card__subheading: date__formatted,
  reference_card__url: url,
  reference_card__overlay: node.pin_label,
} %}
